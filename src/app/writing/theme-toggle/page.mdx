import { ThemeToggleDemo } from "./ThemeToggleDemo";

# Animated Dark Mode Transition with CSS

For my website, I wanted to have a nice animation when switching between light and dark modes. You can check out the final result by clicking the small icon in the upper-left corner - colors should quickly crossfade, while the toggle itself does a little spherical animation to invert its colors.

This site is a statically generated Next.js React app.

I will be focusing on the CSS implementation of the effect. The implementation of the logic itself in React is mostly based on Josh Comeau’s [Quest for the Perfect Dark Mode](https://www.joshwcomeau.com/react/dark-mode/) with some extra help from [Matt Stobbs’s post](https://www.mattstobbs.com/elderjs-dark-mode/).

- Inline script tag - the key was to use \<script\> instead of nextjs \<Script\>, and put it in the head instead of the beginning of the body
- useColorScheme Hook
- ColorSchemeToggle component

<svg className="sun-and-moon" width="48" height="48" viewBox="0 0 24 24">
  <circle
    class="sun"
    cx="12"
    cy="12"
    r="8"
    mask="url(#moon-mask)"
    fill="currentColor"
  />

  <mask class="moon" id="moon-mask">
    <rect x="0" y="0" width="100%" height="100%" fill="white" />
    <path d="M 12 5 A 7 7 0 0 1 12 19" fill="black" style={{transformOrigin: "center", transform: "rotateY(180deg)"}} />
  </mask>
</svg>

## Defining the Color Palette and Transition

Using CSS variables (a.k.a. [custom properties](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_cascading_variables/Using_CSS_custom_properties)) we define our light color palette, while the dark versions of these colors are overriden under the `.dark` class selector:

```css
body {
  --foreground-color: #ddd;
  --background-color: #111;

  color: var(--foreground-color);
  background-color: var(--background-color);
}

body.dark {
  --foreground-color: #111;
  --background-color: #ddd;
}
```

When the `.dark` class is added or removed, the browser will automatically update all the elements using the variables we defined:

<ThemeToggleDemo isAnimated={false}>
  Click to toggle `.dark` class:
</ThemeToggleDemo>

To get a nice animation between the color modes, we can declare a transition for any property using the variables. For consistency between different elements, I like to define a `--transition-defaults` variable which I can reuse:

```css
body {
  // ...
  --transition-defaults: 400ms ease-out;

  transition:
    background-color var(--transition-defaults),
    color var(--transition-defaults);
}
```

<ThemeToggleDemo isAnimated={true}>
  Click to toggle `.dark` class:
</ThemeToggleDemo>

## Creating the Fancy Toggle

The idea is to have 2 halves
There is a hidden circle in the middle with scaleX(0), with each half being one color
On animating, the hidden inner circle is animated to a scale of scaleX(1), then the two halves are flipped, then the scale is animated back to scaleX(0)

<ThemeToggleDemo showToggle />
_Demo embed_ https://codepen.io/shamir/pen/YGbbNX

### The Setup

HTML button element

```html
<button class="ThemeToggle">
  <span class="ThemeToggle__half ThemeToggle__half--left"></span>
  <span class="ThemeToggle__half ThemeToggle__half--right"></span>
</button>
```

CSS

```css
.ThemeToggle {
  --size: 60px;
  --border-width: 2px;
}
```

### Animating the toggle

The animation is split into 4 parts:

1. The initial state
2. The first half of the animation
3. The second half of the animation
4. The final state

## Final touches - the gap

The gap is created by the border-width and the size of the button.

box shadow trick

```css
.ThemeToggle {
  --size: 60px;
  --border-width: 2px;
}
```

## Final touches - favicon

dynamic favicon

Dark to light vs light to dark timing

Pallete / theme / scheme / mode?
