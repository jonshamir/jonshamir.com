import { ThemeToggleDemo } from "./ThemeToggleDemo";

# Animated dark mode with CSS

How to implement an animated dark mode transition using CSS custom properties

Part of the fun of working on a personal website is to spend unnecessary amounts of time on small details. For this site, I wanted to have a nice transition to reduce the harshness when switching betwewen light & dark mode.

You can check out the final result by clicking the small icon in the upper-left hand corner. The colors should quickly crossfade, while the icon itself does a little spherical animation to invert its colors.

I wanted to share my technique here, it is very much inspired by Josh Comeau's [ Quest for the Perfect Dark Mode](https://www.joshwcomeau.com/react/dark-mode/), and

Also inspired by [Matt Stobbs's post](https://www.mattstobbs.com/elderjs-dark-mode/)

## Defining the color palette and transition

Using CSS variables (a.k.a. [custom properties](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_cascading_variables/Using_CSS_custom_properties)) we define our light color palette, while the dark versions of these colors are overriden under the `.dark` class selector:

```css
body {
  --foreground-color: #ddd;
  --background-color: #111;

  color: var(--foreground-color);
  background-color: var(--background-color);
}

body.dark {
  --foreground-color: #111;
  --background-color: #ddd;
}
```

When adding / removing the `.dark` class from the document, the browser will automatically update all the elements using the variables we defined:

<ThemeToggleDemo isAnimated={false}>
  Click to toggle `.dark` class:
</ThemeToggleDemo>

To get a nice animation between the color modes, we can declare a transition for any property using the variables. For consistency across a website, I like to define a `--transition-defaults` variable which I can reuse:

```css
body {
  // ...
  --transition-defaults: 400ms ease-out;

  transition:
    background-color var(--transition-defaults),
    color var(--transition-defaults);
}
```

<ThemeToggleDemo isAnimated={true}>
  Click to toggle `.dark` class:
</ThemeToggleDemo>

This site is a statically generated using next.js generated blog. I will overview the implementation here, but if you are interested in the details of how dark mode is implemented, I highly recommend Josh Comeau's [Quest for the Perfect Dark Mode](https://www.joshwcomeau.com/react/dark-mode/), and I go into more details at the end.

Also inspired by:
https://www.mattstobbs.com/elderjs-dark-mode/

- Inline script tag - the key was to use \<script\> instead of nextjs \<Script\>, and put it in the head instead of the beginning of the body
- useColorScheme Hook
- ColorSchemeToggle component

## Making the fancy toggle

So how does it work?
The idea is to have 2 halves
There is a hidden circle in the middle with scaleX(0), with each half being one color
On animating, the hidden inner circle is animated to a scale of scaleX(1), then the two halves are flipped, then the scale is animated back to scaleX(0)

<ThemeToggleDemo showToggle />
_Demo embed_ https://codepen.io/shamir/pen/YGbbNX

## The Setup

HTML button element

```html
<button class="ThemeToggle">
  <span class="ThemeToggle__half ThemeToggle__half--left"></span>
  <span class="ThemeToggle__half ThemeToggle__half--right"></span>
</button>
```

CSS

```css
.ThemeToggle {
  --size: 60px;
  --border-width: 2px;
}
```

## The Animation

The animation is split into 4 parts:

1. The initial state
2. The first half of the animation
3. The second half of the animation
4. The final state

## Final touches - the gap

The gap is created by the border-width and the size of the button.

box shadow trick

```css
.ThemeToggle {
  --size: 60px;
  --border-width: 2px;
}
```

## Final touches - favicon

dynamic favicon

Dark to light vs light to dark timing

Pallete / theme / scheme / mode?
